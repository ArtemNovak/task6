trigger:
- main

pool:
  vmImage: agent-runner-an

variables:
  GOVERSION: '1.24'
  GOPATH: '$(Pipeline.Workspace)/go'
  modulePath: '$(System.DefaultWorkingDirectory)'

steps:
- task: GoTool@0
  inputs:
    version: '$(GOVERSION)'
  displayName: 'Install Go'

- script: go mod download
  workingDirectory: '$(modulePath)'
  displayName: 'Download dependencies'

- script: go test -v ./...
  workingDirectory: '$(modulePath)'
  displayName: 'Run tests'

- script: go build -v .
  workingDirectory: '$(modulePath)'
  displayName: 'Build application'

- script: go vet ./...
  workingDirectory: '$(modulePath)'
  displayName: 'Run go vet'